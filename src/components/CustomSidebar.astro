---
import MobileMenuFooter from 'virtual:starlight/components/MobileMenuFooter';
import SidebarPersister from './SidebarPersister.astro';
import SidebarSublist from './SidebarSublist.astro';

let { sidebar } = Astro.locals.starlightRoute;

// Filter sidebar items per path
const path = Astro.url.pathname;

if (path.startsWith('/truetech/')) {
  sidebar = sidebar.filter(item => item.autogenerate?.directory?.startsWith('truetech'));
} else if (path.startsWith('/gamingforge/')) {
  sidebar = sidebar.filter(item => item.autogenerate?.directory?.startsWith('gamingforge'));
} else if (path.startsWith('/lifeforge/')) {
  sidebar = sidebar.filter(item => item.autogenerate?.directory?.startsWith('lifeforge'));
} else {
  // root or default
  sidebar = sidebar.filter(item => !item.autogenerate?.directory?.includes('truetech') &&
                                   !item.autogenerate?.directory?.includes('gamingforge') &&
                                   !item.autogenerate?.directory?.includes('lifeforge'));
}
---

<SidebarPersister>
  <SidebarSublist sublist={sidebar} />
</SidebarPersister>

<div class="md:sl-hidden">
  <MobileMenuFooter />
</div>
